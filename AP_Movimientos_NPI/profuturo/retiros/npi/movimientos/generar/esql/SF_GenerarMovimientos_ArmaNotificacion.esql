BROKER SCHEMA profuturo.retiros.npi.movimientos.generar.esql


CREATE COMPUTE MODULE SF_GenerarMovimientos_ArmaNotificacion
	CREATE FUNCTION Main() RETURNS BOOLEAN
	BEGIN
		SET Environment.variables.informar.resultado = 'SIN HALLAZGOS';
		SET Environment.variables.informar.folio = Environment.Request.sr_folio;
		PROPAGATE TO LABEL 'actualizarBitacora';

		SET Environment.ResultadoUCA = '1004';
		SET Environment.MensajeResultado = 'Generación de movimientos exitosa';
				
		DECLARE nsNot   NAMESPACE 'http://mx.profuturo/iib/nci/Notificaciones/EnvioCorreoService/v1/types';
		SET Environment.temporalIn = InputRoot;
		DELETE FIELD InputLocalEnvironment.Destination.File;
		DELETE FIELD Environment.Destination.File;
		PROPAGATE TO TERMINAL 'out1';
		
		SET OutputRoot.XMLNSC.nsNot:enviarCorreoRequest.datosCorreo.para.email[1] = Environment.properties.mail;
		SET OutputRoot.XMLNSC.nsNot:enviarCorreoRequest.datosCorreo.de.email[1] = Environment.properties.mailDe;
		SET OutputRoot.XMLNSC.nsNot:enviarCorreoRequest.datosCorreo.asunto = '';
		SET OutputRoot.XMLNSC.nsNot:enviarCorreoRequest.datosCorreo.mensaje = '';

		SET OutputRoot.XMLNSC.nsNot:enviarCorreoRequest.datosMensaje.idNotificacion = Environment.properties.idNotificacionMovimientos;

		CREATE LASTCHILD OF OutputRoot.XMLNSC.nsNot:enviarCorreoRequest.datosMensaje.parametros NAME 'parametro';
		DECLARE refParametros REFERENCE TO OutputRoot.XMLNSC.nsNot:enviarCorreoRequest.datosMensaje.parametros;
		
		SET refParametros.parametro[<].clave = 'Varsubproceso';
		SET refParametros.parametro[<].valor = 'NOTIFICACIÓN PAGO INFONAVIT';
		
		CREATE LASTCHILD OF OutputRoot.XMLNSC.nsNot:enviarCorreoRequest.datosMensaje.parametros NAME 'parametro';
		SET refParametros.parametro[<].clave = 'Varnombrearchivo';
		SET refParametros.parametro[<].valor = Environment.Request.sr_nombreArchivo;
		
		CREATE LASTCHILD OF OutputRoot.XMLNSC.nsNot:enviarCorreoRequest.datosMensaje.parametros NAME 'parametro';
		SET refParametros.parametro[<].clave = 'Varfechahora';
		SET refParametros.parametro[<].valor = CAST(CURRENT_GMTTIMESTAMP AS CHARACTER FORMAT 'yyyyMMdd');
		
		CREATE LASTCHILD OF OutputRoot.XMLNSC.nsNot:enviarCorreoRequest.datosMensaje.parametros NAME 'parametro';
		SET refParametros.parametro[<].clave = 'Varfolio';
		SET refParametros.parametro[<].valor = Environment.Request.sr_folio;


		RETURN TRUE;
	END;

END MODULE;
